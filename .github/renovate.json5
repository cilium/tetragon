{
  username: 'cilium-renovate[bot]',
  repositories: [
    'cilium/tetragon',
  ],
  requireConfig: 'ignored',
  allowedCommands: [
    '^/tmp/install-buildx$',
    '^make protogen$',
    '^make crds$',
    '^make vendor$',
    '^make -C install/kubernetes$',
    '^go mod vendor$',
    "^install-tool golang \\$\\(grep -oP '\\^toolchain go\\\\K\\.\\+\\$' go.mod \\|\\| grep -oP '\\^go \\\\K\\.\\+\\$' go.mod\\)$",
    '^make metrics-docs$',
  ],
  $schema: 'https://docs.renovatebot.com/renovate-schema.json',
  extends: [
    'config:recommended',
    ':gitSignOff',
    'helpers:pinGitHubActionDigests',
  ],
  ignorePresets: [
    ':ignoreModulesAndTests',
  ],
  gitAuthor: 'cilium-renovate[bot] <134692979+cilium-renovate[bot]@users.noreply.github.com>',
  includePaths: [
    '.github/renovate.json5',
    '.github/workflows/**',
    'go.mod',
    'go.sum',
    'api/go.mod',
    'api/go.sum',
    'pkg/k8s/go.mod',
    'pkg/k8s/go.sum',
    'contrib/tetragon-rthooks/go.mod',
    'contrib/tetragon-rthooks/go.sum',
    '*Dockerfile*',
    'docs/hugo.toml',
    'install/kubernetes/*/Chart.yaml',
    'install/kubernetes/*/Chart.lock',
    'install/kubernetes/*/values.yaml',
    '**/*Makefile*',
    'contrib/update-helm-chart.sh',
    'cmd/tetragon-metrics-docs/metricsmd/metricsmd.go',
    'tests/e2e/helpers/cluster.go',
    'tests/e2e/flags/flags.go',
  ],
  postUpdateOptions: [
    'gomodTidy',
  ],
  rebaseWhen: 'conflicted',
  pinDigests: true,
  separateMajorMinor: true,
  separateMultipleMajor: true,
  separateMinorPatch: true,
  pruneStaleBranches: true,
  baseBranchPatterns: [
    'main',
    'v1.3',
    'v1.4',
    'v1.5',
  ],
  vulnerabilityAlerts: {
    enabled: true,
  },
  osvVulnerabilityAlerts: true,
  labels: [
    'release-blocker',
    'release-note/dependency',
  ],
  schedule: [
    'on monday and friday',
  ],
  prHourlyLimit: 2,
  packageRules: [
    {
      groupName: 'all github action dependencies',
      groupSlug: 'all-github-action',
      matchFileNames: [
        '.github/workflows/**',
      ],
      matchManagers: [
        'github-actions',
      ],
      matchUpdateTypes: [
        'major',
        'minor',
        'patch',
        'digest',
        'pin',
        'pinDigest',
      ],
      schedule: [
        'every month',
      ],
    },
    {
      matchFileNames: [
        '.github/workflows/**',
      ],
      matchManagers: [
        'github-actions',
      ],
      separateMinorPatch: false,
    },
    {
      groupName: 'all go dependencies main',
      groupSlug: 'all-go-deps-main',
      matchFileNames: [
        'go.mod',
        'go.sum',
      ],
      matchUpdateTypes: [
        'minor',
        'patch',
        'digest',
        'pin',
        'pinDigest',
      ],
    },
    {
      groupName: 'all API go dependencies main',
      groupSlug: 'all-api-go-deps-main',
      matchFileNames: [
        'api/go.mod',
        'api/go.sum',
      ],
      matchUpdateTypes: [
        'major',
        'minor',
        'patch',
        'digest',
        'pin',
        'pinDigest',
      ],
    },
    {
      groupName: 'all k8s pkg go dependencies main',
      groupSlug: 'all-k8s-pkg-go-deps-main',
      matchFileNames: [
        'pkg/k8s/go.mod',
        'pkg/k8s/go.sum',
      ],
      matchUpdateTypes: [
        'minor',
        'patch',
        'digest',
        'pin',
        'pinDigest',
      ],
    },
    {
      groupName: 'all rthook go dependencies main',
      groupSlug: 'all-rthook-go-deps-main',
      matchFileNames: [
        'contrib/tetragon-rthooks/go.mod',
        'contrib/tetragon-rthooks/go.mod',
      ],
      matchUpdateTypes: [
        'minor',
        'patch',
        'digest',
        'pin',
        'pinDigest',
      ],
    },
    {
      matchManagers: [
        'gomod',
      ],
      postUpdateOptions: [
        'gomodUpdateImportPaths',
      ],
      postUpgradeTasks: {
        commands: [
          '/tmp/install-buildx',
          'make protogen',
          'make crds',
          'make metrics-docs',
          'make vendor',
        ],
        fileFilters: [
          '**/**',
        ],
        executionMode: 'branch',
      },
    },
    {
      groupName: 'Go',
      matchPackageNames: [
        'go',
        'docker.io/library/golang',
      ],
    },
    {
      matchPackageNames: [
        'go',
        'docker.io/library/golang',
      ],
      matchBaseBranches: [
        'main',
      ],
      postUpgradeTasks: {
        commands: [
          "install-tool golang $(grep -oP '^toolchain go\\K.+$' go.mod || grep -oP '^go \\K.+$' go.mod)",
          'make vendor',
          'make metrics-docs',
        ],
        fileFilters: [
          '**/**',
        ],
        executionMode: 'branch',
      },
    },
    {
      matchPackageNames: [
        'go',
        'docker.io/library/golang',
      ],
      matchBaseBranches: [
        'v1.3',
        'v1.4',
        'v1.5',
      ],
      postUpgradeTasks: {
        commands: [
          "install-tool golang $(grep -oP '^toolchain go\\K.+$' go.mod || grep -oP '^go \\K.+$' go.mod)",
          'make vendor',
          'make metrics-docs',
        ],
        fileFilters: [
          '**/**',
        ],
        executionMode: 'branch',
      },
    },
    {
      groupName: 'golangci-lint',
      matchDepNames: [
        'golangci/golangci-lint',
      ],
    },
    {
      groupName: 'Helm chart',
      matchFileNames: [
        'install/kubernetes/tetragon/values.yaml',
        'install/kubernetes/Makefile',
      ],
      postUpgradeTasks: {
        commands: [
          'make -C install/kubernetes',
        ],
        fileFilters: [
          '**/**',
        ],
        executionMode: 'branch',
      },
    },
    {
      matchDepNames: [
        'quay.io/lvh-images/kernel-images',
        'quay.io/lvh-images/kind',
      ],
      versioning: 'regex:^((?<compatibility>[a-z0-9-]+)|((?<major>\\d+)\\.(?<minor>\\d+)))\\-(?<patch>\\d+)\\.(?<build>\\d+)(@(?<currentDigest>sha256:[a-f0-9]+))?$',
    },
    {
      groupName: 'all lvh-images main',
      groupSlug: 'all-lvh-images-main',
      matchPackageNames: [
        'quay.io/lvh-images/kernel-images',
        'quay.io/lvh-images/kind',
      ],
      matchUpdateTypes: [
        'digest',
        'patch',
        'pin',
        'pinDigest',
      ],
    },
    {
      enabled: false,
      matchPackageNames: [
        '*',
      ],
      matchBaseBranches: [
        'v1.3',
        'v1.4',
        'v1.5',
      ],
    },
    {
      enabled: true,
      matchPackageNames: [
        'docker.io/library/alpine',
      ],
      matchBaseBranches: [
        'v1.3',
        'v1.4',
        'v1.5',
      ],
    },
    {
      enabled: true,
      matchPackageNames: [
        'go',
        'docker.io/library/golang',
      ],
      allowedVersions: '/^1\\.23\\.[0-9]+-?(alpine)?$/',
      matchBaseBranches: [
        'v1.3',
      ],
    },
    {
      enabled: true,
      matchPackageNames: [
        'go',
        'docker.io/library/golang',
      ],
      allowedVersions: '/^1\\.24\\.[0-9]+-?(alpine)?$/',
      matchBaseBranches: [
        'v1.4',
        'v1.5',
      ],
    },
    {
      enabled: false,
      matchFileNames: [
        'go.mod',
        'api/go.mod',
        'pkg/k8s/go.mod',
        'contrib/tetragon-rthooks/go.mod',
      ],
      matchPackageNames: [
        'go',
      ],
      matchDatasources: [
        'golang-version',
      ],
      matchUpdateTypes: [
        'patch',
      ],
    },
    {
      enabled: false,
      matchPackageNames: [
        'quay.io/lvh-images/kernel-images',
        'quay.io/lvh-images/kind',
      ],
      matchUpdateTypes: [
        'major',
        'minor',
      ],
    },
    {
      matchPackageNames: [
        'github.com/cilium/tetragon/api',
        'github.com/cilium/tetragon/pkg/k8s',
        'github.com/cilium/tetragon',
      ],
      matchManagers: [
        'gomod',
      ],
      enabled: false,
    },
    {
      matchPackageNames: [
        'sigstore/cosign-installer',
      ],
      matchManagers: [
        'github-actions',
      ],
      enabled: false,
    },
    {
      matchPackageNames: [
        'docker.io/library/ubuntu',
      ],
      matchManagers: [
        'dockerfile',
      ],
      matchFileNames: [
        'Dockerfile.clang',
        'Dockerfile.clang-format',
      ],
      enabled: false,
    },
    {
      enabled: false,
      matchPackageNames: [
        'k8s\\.io/*',
        'sigs\\.k8s\\.io/*',
        'github.com/google/cel-go',
      ],
      matchUpdateTypes: [
        'major',
        'minor',
        'digest',
      ],
    },
    {
      enabled: false,
      matchPackageNames: [
        'github.com/containerd/cgroups',
        'github.com/pelletier/go-toml',
      ],
      matchUpdateTypes: [
        'major',
      ],
    },
    {
      enabled: false,
      matchFileNames: [
        'contrib/tetragon-rthooks/go.*',
      ],
      matchPackageNames: [
        'github.com/containerd/containerd',
      ],
      matchUpdateTypes: [
        'major',
      ],
    },
    {
      enabled: false,
      matchDatasources: [
        'docker',
      ],
      matchUpdateTypes: [
        'digest',
      ],
      matchPackageNames: [
        '!docker.io/library/alpine',
      ],
    },
    {
      matchPackageNames: [
        'docker.io/library/**',
        'quay.io/cilium/**',
        'quay.io/lvh-images/kernel-images',
        'google/**',
        'kindest/**',
        'github.com/golang/**',
        'golang.org/x/**',
        'google.golang.org/**',
        'github.com/google/**',
        'k8s.io/**',
        'sigs.k8s.io/**',
        'github.com/cilium/**',
        'github.com/prometheus/**',
        'github.com/hashicorp/**',
        'go.uber.org/**',
        'cilium/**',
        'helm/**',
        'go',
      ],
      matchUpdateTypes: [
        'minor',
        'patch',
        'pin',
        'pinDigest',
      ],
      automerge: true,
    },
  ],
  customManagers: [
    {
      customType: 'regex',
      managerFilePatterns: [
        '/^\\.github/workflows/[^/]+\\.ya?ml$/',
        'docs/hugo.toml',
      ],
      matchStrings: [
        '# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+.+ [\'"]?(?<currentValue>[^\'"\\s]*)',
      ],
    },
    {
      customType: 'regex',
      managerFilePatterns: [
        '**/Makefile*',
        'contrib/update-helm-chart.sh',
      ],
      matchStrings: [
        '# renovate: datasource=(?<datasource>.*?)\\s+.+[[:blank:]]*=[[:blank:]]*(?<depName>.*?):(?<currentValue>[^\\s@]*)@?(?<currentDigest>sha256:[a-f0-9]+)?',
      ],
    },
    {
      customType: 'regex',
      managerFilePatterns: [
        '**/**go.mod',
      ],
      matchStrings: [
        '// renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+go (?<currentValue>.*)',
      ],
    },
    {
      customType: 'regex',
      managerFilePatterns: [
        'Dockerfile',
      ],
      matchStrings: [
        '# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+&& git clone --depth 1 --branch (?<currentValue>v\\d+\\.\\d+\\.\\d+)',
      ],
    },
    {
      customType: 'regex',
      managerFilePatterns: [
        'cmd/tetragon-metrics-docs/metricsmd/metricsmd.go',
      ],
      matchStrings: [
        '\\/\\/ renovate: datasource=(?<datasource>.*?)\\s+Values: \\[]string{"(?<depName>go)(?<currentValue>.*?)"',
      ],
    },
    {
      customType: 'regex',
      managerFilePatterns: [
        'tests/e2e/helpers/cluster.go',
      ],
      matchStrings: [
        '\\/\\/ renovate: datasource=(?<datasource>.*?)\\s+.*"(?<depName>.*?):(?<currentValue>.*?)"',
      ],
    },
    {
      customType: 'regex',
      managerFilePatterns: [
        'tests/e2e/flags/flags.go',
      ],
      matchStrings: [
        '\\/\\/ renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+CiliumVersion:\\s*"(?<currentValue>.*?)"',
      ],
    },
  ],
}
